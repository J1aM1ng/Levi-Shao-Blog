---
title: 2741. Special Permutations
date: 2023-06-19
categories:
 - algorithm
tags:
 - algorithm
sidebar: 'auto'
---

```typescript
// bitmask DP 状压DP
// O(2^n * n^2) 时间
const specialPerm = (nums: number[]): number => {
    const MOD: number = 1e9 + 7, n: number = nums.length, fullMask: number = (1 << n) - 1;
    let ans: number = 0;
    // cache
    const memo: Array<Array<number>> = new Array(1 << n).fill(0).map(() => new Array(n).fill(-1));
    const dp = (mask: number, prevIdx: number): number => {
        // 找到一个特别排列
        if (mask === fullMask) {
            return 1;
        }
        if (memo[mask][prevIdx] !== -1) {
            return memo[mask][prevIdx];
        }
        let res = 0;
        for (let i = 0; i < n; ++i) {
            if ((mask >> i) & 1) {
                continue;
            }
            if ((nums[i] % nums[prevIdx] === 0) || (nums[prevIdx] % nums[i] === 0)) {
                let newMask = mask | (1 << i);
                res = (res + dp(newMask, i)) % MOD;
            }
        }
        return memo[mask][prevIdx] = res;
    }
    for (let i = 0; i < n; ++i) {
        ans = (ans + dp(1 << i, i)) % MOD;
    }
    return ans;
};


```
